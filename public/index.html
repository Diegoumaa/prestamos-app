<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Préstamos</title>
</head>
<body>
  <h1>Administración de Préstamos</h1>

  <div id="auth-container">
    <h2>Registro</h2>
    <form id="register-form">
      <input type="text" id="register-username" placeholder="Username" required>
      <input type="password" id="register-password" placeholder="Password" required>
      <button type="submit">Register</button>
    </form>
    <div id="register-message"></div>

    <h2>Inicio de Sesión</h2>
    <form id="login-form">
      <input type="text" id="login-username" placeholder="Username" required>
      <input type="password" id="login-password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
    <div id="login-message"></div>
  </div>

  <div id="loans-container" style="display: none;">
    <h2>Añadir Cliente de Préstamo</h2>
    <form id="add-loan-client-form">
      <input type="text" id="client-name" placeholder="Nombre" required>
      <input type="number" id="client-capital" placeholder="Capital" required>
      <input type="number" id="client-porcentaje" placeholder="Porcentaje" required>
      <input type="number" id="client-cuota-mensual" placeholder="Cuota Mensual" required>
      <button type="submit">Añadir Cliente</button>
    </form>

    <h2>Lista de Clientes de Préstamos</h2>
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Capital</th>
          <th>Abonos</th>
          <th>Porcentaje</th>
          <th>Cuota Mensual</th>
        </tr>
      </thead>
      <tbody id="loans-table-body">
        <!-- Datos de préstamos aquí -->
      </tbody>
    </table>
  </div>

  <script>
    const backendUrl = 'https://mi-backend.netlify.app';

    async function registerUser(event) {
      event.preventDefault();
      const username = document.getElementById('register-username').value;
      const password = document.getElementById('register-password').value;

      const response = await fetch(`${backendUrl}/api/auth/register`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();
      const messageDiv = document.getElementById('register-message');
      if (response.status === 201) {
        messageDiv.textContent = data.message;
        messageDiv.style.color = 'green';
      } else {
        messageDiv.textContent = data.message;
        messageDiv.style.color = 'red';
      }
    }

    async function loginUser(event) {
      event.preventDefault();
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;

      const response = await fetch(`${backendUrl}/api/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();
      const messageDiv = document.getElementById('login-message');
      if (response.status === 200) {
        localStorage.setItem('token', data.token);
        messageDiv.textContent = data.message;
        messageDiv.style.color = 'green';
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('loans-container').style.display = 'block';
        fetchLoans();
      } else {
        messageDiv.textContent = data.message;
        messageDiv.style.color = 'red';
      }
    }

    async function fetchLoans() {
      const token = localStorage.getItem('token');
      const response = await fetch(`${backendUrl}/api/loans`, {
        headers: {
          'Authorization': token
        }
      });
      const loans = await response.json();
      const tableBody = document.getElementById('loans-table-body');
      tableBody.innerHTML = ''; // Clear the table before adding new data
      loans.forEach(loan => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${loan.name}</td>
          <td>${loan.capital}</td>
          <td>${loan.abonos}</td>
          <td>${loan.porcentaje}</td>
          <td>${loan.cuotaMensual}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    document.getElementById('register-form').addEventListener('submit', registerUser);
    document.getElementById('login-form').addEventListener('submit', loginUser);
  </script>
</body>
</html>
