<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Préstamos</title>
</head>
<body>
  <h1>Administración de Préstamos</h1>

  <div id="auth-container">
    <h2>Registro</h2>
    <form id="register-form">
      <input type="text" id="register-username" placeholder="Username" required>
      <input type="password" id="register-password" placeholder="Password" required>
      <button type="submit">Register</button>
    </form>

    <h2>Inicio de Sesión</h2>
    <form id="login-form">
      <input type="text" id="login-username" placeholder="Username" required>
      <input type="password" id="login-password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
  </div>

  <div id="loans-container" style="display: none;">
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Capital</th>
          <th>Abonos</th>
          <th>Porcentaje</th>
          <th>Cuota Mensual</th>
        </tr>
      </thead>
      <tbody id="loans-table-body">
        <!-- Datos de préstamos aquí -->
      </tbody>
    </table>
  </div>

  <script>
    async function registerUser(event) {
      event.preventDefault();
      const username = document.getElementById('register-username').value;
      const password = document.getElementById('register-password').value;

      const response = await fetch('/api/auth/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();
      alert(data.message);
    }

    async function loginUser(event) {
      event.preventDefault();
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;

      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();
      if (data.token) {
        localStorage.setItem('token', data.token);
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('loans-container').style.display = 'block';
        fetchLoans();
      } else {
        alert(data.message);
      }
    }

    async function fetchLoans() {
      const token = localStorage.getItem('token');
      const response = await fetch('/api/loans', {
        headers: {
          'Authorization': token
        }
      });
      const loans = await response.json();
      const tableBody = document.getElementById('loans-table-body');
      loans.forEach(loan => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${loan.nombre}</td>
          <td>${loan.capital}</td>
          <td>${loan.abonos}</td>
          <td>${loan.porcentaje}</td>
          <td>${loan.cuotaMensual}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    document.getElementById('register-form').addEventListener('submit', registerUser);
    document.getElementById('login-form').addEventListener('submit', loginUser);
  </script>
</body>
</html>
